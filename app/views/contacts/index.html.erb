<h1>Contact</h1>
<p>
  <div class="pull-left">
    <b><%=Contact.count %> data </b> Contact <br>
  </div>
  <div class="pull-right">
    <% if can? :create, Contact %>
    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">new</button>
    <% end %>

  </div>
</p>

<table class="table table-borderd table-striped">
  <thead>
  <tr>
    <th>Name</th>
    <th>Phone Number</th>
    <th colspan="3">Actions</th>
  </tr>
  </thead>

  <tbody id="content-table">
  <% @contact.each do |contact| %>
      <tr>
        <td><%= contact.name %></td>
        <td><%= contact.phone_number %></td>
        <td><%= link_to 'Show', contact , :class=>'btn btn-primary' %>
          <% if can? :edit, Contact %>
          <%= link_to 'Edit', edit_contact_path(contact) , :class=>'btn btn-warning'%>
          <% end %>
          <% if can? :destroy, Contact %>
          <%= link_to 'Destroy', contact, method: :delete, data: { confirm: 'Are you sure?' } ,:class=>'btn btn-danger' %>
          <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>


<% contact = Contact.new%>
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body" id="modal-content">
        <%= form_with(id:'myForm', model: contact, remote:true) do |form| %>
            <% if contact.errors.any? %>
                <div id="error_explanation">
                  <h2><%= pluralize(contact.errors.count, "error") %> prohibited this news from being saved:</h2>

                  <ul>
                    <% contact.errors.full_messages.each do |message| %>
                        <li><%= message %></li>
                    <% end %>
                  </ul>
                </div>
            <% end %>

            <div class="field">
              <%= form.label :name %>
            </div>
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon3">Name</span>
              <%= form.text_field :name, id: :name , :class=>'form-control'%>
            </div><br>

            <div class="field">
              <%= form.label :phone_number %>
            </div>
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon3">Phone Number</span>
              <%= form.text_field :phone_number, id: :phone_number , :class=>'form-control'%>
            </div>

            <div class="input-group" style="display: none">
              <span class="input-group-addon" id="basic-addon3">Owner</span>
              <%= form.text_field :owner, id: :owner , :class=>'form-control', value:current_user.id%>
            </div>

            <div class="actions"><br>
              <%= form.submit :class=>'btn btn-primary'%>
            </div>
        <% end %>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  $('form').submit(function(e){
      e.preventDefault();
      var data = $(this).serialize();

      console.log(data);
      $.ajax({
         url:$(this).attr('action'),
         method:'POST',
         data:data,
         success:function (data) {
             $('#myModal').modal('hide');
             document.getElementById("myForm").reset();
             window.location.reload();
         }
      });
  });

</script>
